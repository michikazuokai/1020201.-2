%----------------------------------------------------------------------------------------
%  metropolis template (refactored)
%----------------------------------------------------------------------------------------
\documentclass[aspectratio=169]{beamer}

% \documentclass の直後で hyperref のオプションを渡す（metropolisでも安全）
\PassOptionsToPackage{unicode=true,colorlinks=true,linkcolor=blue,urlcolor=blue}{hyperref}

\usetheme{metropolis}
\metroset{block=fill, sectionpage=progressbar, progressbar=foot}

% 背景色（tech のとき白など）: Pythonで差し込み


%--------------------------
% 日本語
%--------------------------
\usepackage{luatexja}
\usepackage{luatexja-fontspec}
\usepackage{luatexja-ruby}
\setsansjfont{Hiragino Sans}[BoldFont={Hiragino Sans W6}]

%--------------------------
% 基本パッケージ（重複なし）
%--------------------------
\usepackage[table]{xcolor}
\usepackage{graphicx}
\usepackage[abs]{overpic}
\usepackage{tikz}
\usepackage{array}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{makecell}
\usepackage{mathtools}
\usepackage{longtable}
\usepackage{pdfpages}
\usepackage{etoolbox} % AtBeginEnvironment 等
\usetikzlibrary{calc}
\usetikzlibrary{backgrounds}

% minted（※ -shell-escape 必須）
\usepackage{minted}
\setminted{
  frame=single,
  framesep=2mm,
  fontsize=\footnotesize,
  breaklines=true
}

% （必要なときだけ）tcolorbox
\usepackage[most]{tcolorbox}

% hyperref は最後
\usepackage{hyperref}

%--------------------------
% パス
%--------------------------
\newcommand{\assetpath}{/Volumes/NBPlan/TTC/授業資料/2025年度/}
\graphicspath{{images/}{\assetpath/1020201.アルゴリズム２/10/images/}{../project_assets/images/}{../project_assets/emoji/emoji_pngs/}}

%--------------------------
% フッター
%--------------------------
\newcommand{\myfootertext}{1020201.アルゴリズム２/10}
\setbeamertemplate{footline}{%
  \leavevmode
  \hbox to \paperwidth{%
    \hspace*{0.2cm}
    \scriptsize\color{gray!50} \myfootertext
    \hfill
    \scriptsize\color{gray} \insertframenumber{} / \inserttotalframenumber
    \hspace*{0.4cm}
  }%
  \vspace{1pt}
}

%--------------------------
% TeacherFrame（外部）
%--------------------------
\usepackage{../teacherframe}

%--------------------------
% フレームタイトル：番号. タイトル
% ※ ここで出すだけ。insertframetitle を再定義しない（安全）
%--------------------------
\setbeamertemplate{frametitle}{%
  \vspace{0.6ex}%
  \begin{beamercolorbox}[wd=\paperwidth,sep=0.5ex,leftskip=0.9em,rightskip=0.5em]{frametitle}%
    \usebeamerfont{frametitle}%
    \insertframenumber.\,\insertframetitle%
  \end{beamercolorbox}%
}

%--------------------------
% 表用：列型
%--------------------------
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{M}[1]{>{\raggedright\arraybackslash}m{#1}}

%--------------------------
% ブロック（必要なら）
%--------------------------
\definecolor{myblue}{HTML}{7488FF}
\definecolor{mylightblue}{HTML}{E3EEFF}
\setbeamertemplate{blocks}[rounded]
\setbeamercolor{block title}{bg=myblue, fg=white}
\setbeamercolor{block body}{bg=mylightblue, fg=black}

%========================================================
% exampleblock（examplebox相当）だけの調整
%  - タイトル文字：白
%  - 背景色：現行のまま（bgは指定しない）
%  - 本文 itemize：文字も●も黒（exampleblock内だけ）
%========================================================

% タイトル文字だけ白（背景は触らない）
\setbeamercolor{block title example}{fg=white}

% 本文の通常文字色は「現行のまま」を基本にする（必要なら黒にしてもよい）
% ここは bg を触らないのが目的なので fg だけ調整可能
\setbeamercolor{block body example}{fg=black}

% exampleblock の中だけ itemize の色（●と文字）を黒に
\AtBeginEnvironment{exampleblock}{%
  \setbeamercolor{itemize item}{fg=black}
  \setbeamercolor{itemize subitem}{fg=black}
  \setbeamercolor{itemize subsubitem}{fg=black}
  \setbeamercolor{item}{fg=black} % 念のため
}

% exampleblock を抜けたらテーマ標準に戻す（色が残る事故防止）
\AtEndEnvironment{exampleblock}{%
  \setbeamercolor{itemize item}{fg=normal text.fg}
  \setbeamercolor{itemize subitem}{fg=normal text.fg}
  \setbeamercolor{itemize subsubitem}{fg=normal text.fg}
  \setbeamercolor{item}{fg=normal text.fg}
}

%--------------------------
% 奇数ページのスライドのを表示する
%（教示用だけでそれ以外はこの処理は動かない）
%--------------------------
% --- 教師用だけ、スライドを奇数開始に強制するトグル ---
\newif\ifoddslideenforce
\oddslideenforcefalse   % デフォルトOFF（pr/hoはOFF）

% --- 再帰防止ガード ---
\newif\ifoddslideguard
\oddslideguardfalse

% --- 偶数ページなら空白スライドを1枚入れて奇数に戻す ---
\newcommand{\ensureoddslide}{%
  \ifoddslideguard\relax\else
    \oddslideguardtrue
    \ifodd\value{page}\relax
      % 何もしない（次が奇数）
    \else
      \begin{frame}[plain,noframenumbering]
        \note{}% notes出力時に2枚消費させる保険
      \end{frame}
    \fi
    \oddslideguardfalse
  \fi
}

% --- frameが始まる直前に自動挿入（教師用だけ）---
\BeforeBeginEnvironment{frame}{%
  \ifoddslideenforce
    \ensureoddslide
  \fi
}

%--------------------------
% note / noteT の「常時安全化」
%  - tech 以外：\noteT は無視（エラーにならない）
%  - tech：notesmode_tech で上書き定義
%--------------------------
\providecommand{\notetitletext}{}      % 既にあっても衝突しない
\providecommand{\noteT}[2]{}           % デフォルトは何もしない

% frame開始ごとにタイトル変数をクリア（前の noteT が残らないように）
\AtBeginEnvironment{frame}{\gdef\notetitletext{}}

%--------------------------
% 切替（Pythonから差し込み）
%--------------------------
\mypausemodetrue
\teachermodefalse

%-------------

\providecommand{\noteT}[2]{} % noteT を無視


%--------------------------
% 方眼紙（グリッド）をスライドに重ね
%--------------------------
\input{grid_debug}

%-------------------------------------------------------------------------
% 「ラインマーカー」そのものです。線の太さ・色・透明度を自由にできます。
%
% #1 色（省略可）
% #2 下端 yshift
% #3 上端 yshift
% #4 文字
% \marklineA{0.35ex}{1.55ex}{通常サイズ}
% {\Large \marklineA{0.45ex}{2.10ex}{大きい文字}}
%-------------------------------------------------------------------------
\newcommand{\marklineA}[4][yellow]{%
  \tikz[baseline=(X.base)]{%
    \node[inner sep=0pt,outer sep=0pt] (X) {#4};
    \begin{scope}[on background layer]
      \fill[#1, opacity=0.35, rounded corners=0.8pt]
        ([xshift=-0.15em,yshift=#2]X.south west) rectangle
        ([xshift= 0.15em,yshift=#3]X.south east);
    \end{scope}
  }%
}

%----------------------------------------------------------------------------------------
% タイトル
%----------------------------------------------------------------------------------------
\title{ 10 仮説検定①（考え方とp値） }
\date{}
\newcommand{\codedir}{\assetpath/1020201.アルゴリズム２/10}

\begin{document}

\begin{frame}[plain,noframenumbering]
  \titlepage
  \bigskip
  \begin{center}
    \ifteachermode 教師用 \fi
  \end{center}
\end{frame}

% セクションページ（必要なら）
\setbeamertemplate{section page}{
  \begin{centering}
    \vfill
    \rule{\linewidth}{2pt}\par
    \vspace{1ex}
    {\usebeamerfont{section title}\Huge\bfseries \insertsection}\par
    \vspace{1ex}
    \rule{\linewidth}{2pt}\par
    \vfill
  \end{centering}
}
\setbeamerfont{section title}{size=\LARGE,series=\bfseries}

\AtBeginSection[]{
  \begin{frame}[plain,noframenumbering]
    \sectionpage
  \end{frame}
}

% 本編開始でフレーム番号を0から（必要なら）
\setcounter{framenumber}{0}

\input{emoji_macros}

% @@@--(metropolis)--@@@
% ===== 第9回：導入（推測統計 → 仮説検定）ポテトのストーリー =====
% ※「アルゴリズム2 Beamer共通仕様 v2025」準拠（frame群のみ）
% ※teacherframeは使わない（noteTのみ）

%----------------------------------------------------------------------------------------
% Slide 01: 導入ストーリー（問い）
%----------------------------------------------------------------------------------------
\begin{frame}{導入：本当に「平均との差」がある？（ポテトの例）}
\small
あるハンバーガーショップでは、ポテトの量は「いつも同じくらい」に見えます。\\
しかし実際には、毎回すこしずつ量が違います（ばらつきがある）。

\vspace{0.6em}
今日もらったポテトは、いつもより\textbf{少ない}ように見えました。

\vspace{0.8em}
\textbf{問い：}\\
これは\textbf{たまたま少なかった}だけでしょうか？\\
それとも\textbf{本当に量が減った}と言ってよいでしょうか？

\vspace{0.8em}
% ---- 図・イラスト提案（ここに挿入） -----------------------------------------------
% 図案A（おすすめ：模式図）
%   ・ポテト箱のイラストを2つ並べる（左：いつも、右：今日）
%   ・右だけ量が少ない見た目にする
%   ・写真よりイラストの方が留学生に伝わりやすいことが多い
%
% 図案B（写真）
%   ・「ポテト（通常）」「ポテト（少なめ）」の写真を左右に配置
%   ・著作権の問題が出やすいので、自作画像 or フリー素材推奨
%
% 挿入例（ファイル名は仮）：
% \begin{center}
%   \includegraphics[width=0.82\linewidth]{img/potato_compare.png}
% \end{center}
% -----------------------------------------------------------------------------

\noteT{導入：ポテトの例（目的と運用）}{
【目的】推測統計から仮説検定へ「判断モード」に切り替える。\\
【口頭補足】「平均と違う」だけでは判断できない。ポイントは「ばらつきの中で珍しいか」。\\
【運用】学生にまず直感で答えさせる（挙手：たまたま派／減った派）。次スライドで回収する。}
\end{frame}

%----------------------------------------------------------------------------------------
% Slide 02: 推測統計ではここまで（限界の明示）
%----------------------------------------------------------------------------------------
\begin{frame}{推測統計では、ここまでしか言えない}
\small
この疑問に対して、これまで学んだ\textbf{推測統計}でできることは次です。

\vspace{0.4em}
\begin{itemize}
  \item 平均（だいたいの中心）を\textbf{見積もる}
  \item ばらつき（標準偏差など）を\textbf{把握する}
  \item 「だいたいこのくらい」と\textbf{説明する}
\end{itemize}

\vspace{0.4em}
しかし推測統計だけでは、次の判断まではできません。

\vspace{0.3em}
\begin{block}{ここが今日のポイント}
\textbf{「本当に量が減ったと言ってよいか？」}\\
＝\textbf{判断}（結論を出す）には、別の考え方が必要
\end{block}

% ---- 図・イラスト提案（ここに挿入） -----------------------------------------------
% 図案（おすすめ：2列対比）
%  左：推測統計（数値・区間）／右：判断（Yes/Noに近い）
%  例：
%   ・左に「平均=○○g」「ばらつき=△△」のメモ風アイコン
%   ・右に「減ったと言ってよい？」の吹き出し＋？マーク
%
% 挿入例（ファイル名は仮）：
% \begin{center}
%   \includegraphics[width=0.88\linewidth]{img/inference_vs_decision.png}
% \end{center}
% -----------------------------------------------------------------------------

\noteT{推測統計の限界（学生の混乱を予防）}{
【目的】「平均を出す＝答えが出る」という誤解をここで止める。\\
【口頭補足】推測は「量を知る」、検定は「判断する」。\\
【運用】「平均との差がある」ことと「本当に変わったと言ってよい」ことは別、と繰り返す。}
\end{frame}

%----------------------------------------------------------------------------------------
% Slide 03: だから仮説検定（新しい目的の提示）
%----------------------------------------------------------------------------------------
\begin{frame}{だから「判断するための統計」＝仮説検定}
\small
「本当に量が減ったと言ってよいか？」に答えるには、次の考え方を使います。

\vspace{0.4em}
\begin{enumerate}
  \item まず\textbf{いつも通り}だと仮定する（基準を置く）
  \item その仮定のもとで、今日の結果が\textbf{どれくらい珍しいか}を見る
  \item とても珍しければ、\textbf{いつも通り}は怪しいと判断する
\end{enumerate}

\vspace{0.5em}
この「珍しさで判断する」方法を、\textbf{仮説検定}と呼びます。

% ---- 図・イラスト提案（ここに挿入） -----------------------------------------------
% 図案A（おすすめ：3ステップの矢印図）
%   「いつも通り（基準）」→「珍しさ」→「判断」
%   ・各ステップに小さなアイコン（基準=定規、珍しさ=分布、判断=判定印）
%
% 図案B（次につながる布石：正規分布の位置）
%   ・ベルカーブ（正規分布）に点を置き、「端＝珍しい」を視覚化
%   ・ここでは細かい式は不要。点の位置だけでOK。
%
% 挿入例（ファイル名は仮）：
% \begin{center}
%   \includegraphics[width=0.88\linewidth]{img/hypothesis_test_flow.png}
% \end{center}
% -----------------------------------------------------------------------------

\noteT{仮説検定の導入（次の用語へつなぐ）}{
【目的】検定を「新しい難語」ではなく「判断の手順」として理解させる。\\
【口頭補足】この後で、\textbf{いつも通り＝帰無仮説}、\textbf{珍しさ＝p値}、\textbf{線引き＝有意水準}と名前を後付けする。\\
【運用】このスライドでは用語を増やさない。まず流れだけ固定する。}
\end{frame}
\end{document}
